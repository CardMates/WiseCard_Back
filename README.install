# WiseCard API ì„¤ì¹˜ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” WiseCard API ì„œë²„ë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­](#ì‹œìŠ¤í…œ-ìš”êµ¬ì‚¬í•­)
- [ì„¤ì¹˜ ë°©ë²•](#ì„¤ì¹˜-ë°©ë²•)
- [ì„¤ì •](#ì„¤ì •)
- [ì‹¤í–‰](#ì‹¤í–‰)
- [ì ‘ì† ì •ë³´](#ì ‘ì†-ì •ë³´)
- [í…ŒìŠ¤íŠ¸ ê³„ì •](#í…ŒìŠ¤íŠ¸-ê³„ì •)
- [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

## ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

### ìµœì†Œ ìš”êµ¬ì‚¬í•­

- **ìš´ì˜ì²´ì œ**: Linux, macOS, Windows
- **Java**: JDK 21 ì´ìƒ
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 512MB RAM (ê¶Œì¥: 1GB ì´ìƒ)
- **ë””ìŠ¤í¬ ê³µê°„**: ìµœì†Œ 500MB
- **ë„¤íŠ¸ì›Œí¬**: ì¸í„°ë„· ì—°ê²° (MongoDB Atlas ì‚¬ìš© ì‹œ)

### ì„ íƒì‚¬í•­

- **Docker**: Docker 20.10 ì´ìƒ (ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ)
- **MongoDB**: ë¡œì»¬ MongoDB 4.4 ì´ìƒ (MongoDB Atlas ëŒ€ì‹  ì‚¬ìš© ì‹œ)

## ì„¤ì¹˜ ë°©ë²•

### ë°©ë²• 1: JAR íŒŒì¼ ì§ì ‘ ì‹¤í–‰ (ê¶Œì¥)

#### 1ë‹¨ê³„: JAR íŒŒì¼ ë‹¤ìš´ë¡œë“œ

í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ì—¬ JAR íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜, ì œê³µëœ `wisecard-api-0.0.1-SNAPSHOT.jar` íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```bash
# ë¹Œë“œ ë°©ë²•
git clone https://github.com/CardMates/WiseCard_Back.git
cd wisecard-api
./gradlew bootJar
```

ìƒì„±ëœ JAR íŒŒì¼ ìœ„ì¹˜: `build/libs/wisecard-api-0.0.1-SNAPSHOT.jar`

#### 2ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

```bash
# MongoDB ì—°ê²° URI
export MONGODB_URI="mongodb+srv://cardmates:cardmates!!@wisecard.fqjvpgx.mongodb.net/wisecard?retryWrites=true&w=majority&appName=wisecard"

# ì„œë²„ í¬íŠ¸ (ê¸°ë³¸ê°’: 8081)
export SERVER_PORT=8081

# gRPC í¬íŠ¸ (ê¸°ë³¸ê°’: 50052)
export GRPC_PORT=50052

# Kakao API í‚¤
export LMM_API_KEY="6e04cfc94461a18e2b77b3a859e2ef0f"
```

#### 3ë‹¨ê³„: JAR íŒŒì¼ ì‹¤í–‰

```bash
java -jar wisecard-api-0.0.1-SNAPSHOT.jar
```

ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ì™€ í•¨ê»˜ ì‹¤í–‰:

```bash
MONGODB_URI="mongodb+srv://cardmates:cardmates!!@wisecard.fqjvpgx.mongodb.net/wisecard?retryWrites=true&w=majority&appName=wisecard" \
SERVER_PORT=8081 \
GRPC_PORT=50052 \
LMM_API_KEY="6e04cfc94461a18e2b77b3a859e2ef0f" \
java -jar wisecard-api-0.0.1-SNAPSHOT.jar
```

### ë°©ë²• 2: Dockerë¥¼ ì‚¬ìš©í•œ ì„¤ì¹˜

#### 1ë‹¨ê³„: Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë˜ëŠ” ë¹Œë“œ

**ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (ì œê³µëœ ê²½ìš°):**
```bash
docker pull wisecard-api:latest
```

**ë˜ëŠ” ì´ë¯¸ì§€ ë¹Œë“œ:**
```bash
git clone https://github.com/CardMates/WiseCard_Back.git
cd wisecard-api
docker build -t wisecard-api:latest .
```

#### 2ë‹¨ê³„: Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
docker run -d \
  --name wisecard-api \
  -p 8081:8081 \
  -p 50052:50052 \
  -e MONGODB_URI="mongodb+srv://cardmates:cardmates!!@wisecard.fqjvpgx.mongodb.net/wisecard?retryWrites=true&w=majority&appName=wisecard" \
  -e SERVER_PORT=8081 \
  -e GRPC_PORT=50052 \
  -e LMM_API_KEY="6e04cfc94461a18e2b77b3a859e2ef0f" \
  wisecard-api:latest
```

#### 3ë‹¨ê³„: ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸

```bash
docker ps
docker logs wisecard-api
```

### ë°©ë²• 3: ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¹Œë“œ ë° ì‹¤í–‰

#### 1ë‹¨ê³„: ì €ì¥ì†Œ í´ë¡ 

```bash
git clone https://github.com/CardMates/WiseCard_Back.git
cd wisecard-api
```

#### 2ë‹¨ê³„: Gradle Wrapper ê¶Œí•œ ì„¤ì • (Linux/Mac)

```bash
chmod +x gradlew
```

#### 3ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`src/main/resources/application.yml` íŒŒì¼ì„ ìˆ˜ì •í•˜ê±°ë‚˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
```yaml
spring:
  data:
    mongodb:
      uri: ${MONGODB_URI:mongodb+srv://cardmates:cardmates!!@wisecard.fqjvpgx.mongodb.net/wisecard?retryWrites=true&w=majority&appName=wisecard}

grpc:
  server:
    port: ${GRPC_PORT:50052}

server:
  port: ${SERVER_PORT:8081}

kakao:
  rest-api-key: ${LMM_API_KEY:6e04cfc94461a18e2b77b3a859e2ef0f}
```

#### 4ë‹¨ê³„: ë¹Œë“œ ë° ì‹¤í–‰

```bash
# ë¹Œë“œ
./gradlew clean build

# ì‹¤í–‰
./gradlew bootRun
```


## ì ‘ì† ì •ë³´

### ì›¹ ì ‘ì† ì£¼ì†Œ

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ë©´ ë‹¤ìŒ ì£¼ì†Œë¡œ ì ‘ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

#### ë¡œì»¬ ì‹¤í–‰ ì‹œ

- **REST API Base URL**: http://localhost:8081
- **Swagger UI**: http://localhost:8081/swagger-ui.html
- **OpenAPI JSON**: http://localhost:8081/v3/api-docs
- **gRPC ì„œë²„**: localhost:50052

#### ì›ê²© ì„œë²„ ì‹¤í–‰ ì‹œ

ì„œë²„ì˜ IP ì£¼ì†Œ ë˜ëŠ” ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†:

- **REST API Base URL**: http://1.201.19.243:8081
- **Swagger UI**: http://1.201.19.243:8081/swagger-ui.html
- **gRPC ì„œë²„**: 1.201.19.243:50052

### ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

- `GET /api/v1/cards` - ì „ì²´ ì¹´ë“œ ì¡°íšŒ
- `POST /api/v1/cards/my` - ë‚´ ì¹´ë“œ ì¡°íšŒ
- `POST /api/v1/cards/offline` - ì˜¤í”„ë¼ì¸ í˜œíƒ ì¡°íšŒ
- `POST /api/v1/cards/online` - ì˜¨ë¼ì¸ í˜œíƒ ì¡°íšŒ
- `GET /api/v1/promotions` - í”„ë¡œëª¨ì…˜ ì¡°íšŒ

## í…ŒìŠ¤íŠ¸ ê³„ì •

### API í…ŒìŠ¤íŠ¸

ì´ APIëŠ” ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ì ‘ APIë¥¼ í˜¸ì¶œí•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í…ŒìŠ¤íŠ¸ ì˜ˆì œ

#### 1. ì „ì²´ ì¹´ë“œ ì¡°íšŒ í…ŒìŠ¤íŠ¸

```bash
curl http://localhost:8081/api/v1/cards
```

#### 2. ì¹´ë“œì‚¬ë³„ í•„í„°ë§ í…ŒìŠ¤íŠ¸

```bash
curl "http://localhost:8081/api/v1/cards?cardCompany=SAMSUNG"
```

#### 3. ë‚´ ì¹´ë“œ ì¡°íšŒ í…ŒìŠ¤íŠ¸

```bash
curl -X POST http://localhost:8081/api/v1/cards/my \
  -H "Content-Type: application/json" \
  -d '{"cardIds": [1, 2, 3]}'
```

#### 4. ì˜¤í”„ë¼ì¸ í˜œíƒ ì¡°íšŒ í…ŒìŠ¤íŠ¸

```bash
curl -X POST "http://localhost:8081/api/v1/cards/offline?x=127.0276&y=37.4979&query=ì¹´í˜" \
  -H "Content-Type: application/json" \
  -d '{"cardIds": [1, 2]}'
```

#### 5. í”„ë¡œëª¨ì…˜ ì¡°íšŒ í…ŒìŠ¤íŠ¸

```bash
curl http://localhost:8081/api/v1/promotions
```

### Swagger UIë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸

1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8081/swagger-ui.html ë˜ëŠ” http://1.201.19.243:8081/swagger-ui.html ì ‘ì†
2. ê° API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ í™•ì¸
3. "Try it out" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì§ì ‘ í…ŒìŠ¤íŠ¸